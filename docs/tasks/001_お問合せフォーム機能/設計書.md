# 001_お問合せフォーム機能

## ユーザーニーズ

### 背景
- ユーザーがサービスについて質問や問い合わせをしたい
- サービス改善のためのフィードバックを収集したい
- サポート対応の窓口が必要

### 解決する課題
1. ユーザーが簡単にサービス運営者に連絡できる手段を提供
2. 問い合わせ内容を記録し、後から確認・対応できるようにする
3. 問い合わせがあったことを管理者にすぐに通知する

## 仕様要件

### 機能要件

#### 1. お問合せフォーム画面
- **URL**: `/contact`
- **入力項目**:
  - 名前（必須）
  - メールアドレス（必須、メール形式）
  - 件名（必須）
  - 本文（必須、複数行）
- **ボタン**:
  - 送信ボタン
  - クリアボタン（オプション）

#### 2. バリデーション
- **必須チェック**: すべてのフィールドが入力されていること
- **メール形式チェック**: メールアドレスが正しい形式であること
- **エラー表示**: リアルタイムでエラーメッセージを表示

#### 3. データ保存
- **MongoDB**: お問合せ内容をデータベースに保存
- **保存項目**:
  - name: String（名前）
  - email: String（メールアドレス）
  - subject: String（件名）
  - message: String（本文）
  - createdAt: Date（作成日時）

#### 4. メール送信
- **Nodemailer**: 管理者へメール通知
- **送信内容**:
  - 件名: `[お問合せ] {件名}`
  - 本文: 名前、メールアドレス、件名、本文を含む

#### 5. 送信完了画面
- 送信成功メッセージを表示
- フォームをクリア
- 「トップページに戻る」リンク

### 非機能要件
- レスポンシブデザイン（PC/タブレット/スマホ対応）
- アクセシビリティ対応（MUIのデフォルト機能を活用）
- エラーハンドリング（サーバーエラー時の適切なメッセージ表示）

## 処理手順設計

### 1. データモデル定義（Mongoose）

**ファイル**: `src/models/Contact.ts`

```typescript
import mongoose from 'mongoose';

const ContactSchema = new mongoose.Schema({
  name: { type: String, required: true },
  email: { type: String, required: true },
  subject: { type: String, required: true },
  message: { type: String, required: true },
  createdAt: { type: Date, default: Date.now }
});

export default mongoose.models.Contact || mongoose.model('Contact', ContactSchema);
```

### 2. API Route実装

**ファイル**: `src/app/api/contact/route.ts`

**処理フロー**:
1. POSTリクエストを受信
2. リクエストボディから `name`, `email`, `subject`, `message` を取得
3. バリデーション（サーバーサイド）
4. MongoDBに接続
5. Contactモデルでデータを保存
6. Nodemailerで管理者にメール送信
7. 成功レスポンスを返す
8. エラー時は適切なエラーレスポンスを返す

### 3. お問合せフォーム画面実装

**ファイル**: `src/app/contact/page.tsx`

**処理フロー**:
1. フォーム状態管理（useState）
2. バリデーション状態管理
3. 入力変更時のバリデーション
4. 送信ボタンクリック時:
   - クライアントサイドバリデーション
   - `/api/contact` へPOSTリクエスト
   - ローディング表示
   - 成功時: 完了メッセージ表示、フォームクリア
   - 失敗時: エラーメッセージ表示

### 4. Nodemailer設定

**ファイル**: `src/lib/nodemailer.ts`

**設定内容**:
- SMTPサーバー設定（Gmail等）
- 送信元メールアドレス
- 管理者メールアドレス

### 5. MongoDB接続設定

**ファイル**: `src/lib/mongodb.ts`

**処理内容**:
- MongoDB接続文字列の設定
- 接続の確立と再利用

## 技術スタック

- **フロントエンド**: Next.js 15 (App Router), MUI
- **バックエンド**: Next.js API Routes
- **データベース**: MongoDB, Mongoose
- **メール送信**: Nodemailer
- **バリデーション**: クライアント＆サーバーサイド

## 実装順序

1. MongoDB接続設定
2. Contactモデル作成
3. Nodemailer設定
4. API Route実装
5. お問合せフォーム画面実装
6. 動作確認・テスト
